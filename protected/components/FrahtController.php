<?php/** * Controller is the customized base controller class. * All controller classes for this application should extend from this base class. */class FrahtController extends Controller{	public $pageName = 'Общая информация';	public $is_access_search = false;	public $messagesCount = 0;	public $notesCount = 0;	public $headerUrl = '/user';//	public $newOffersCount = 0;	public function __construct($id,$module=null)	{		parent::__construct($id,$module=null);		if (Yii::app()->user->isGuest)			Yii::app()->session['redirectUrl'] = Yii::app()->request->requestUri;		else			unset(Yii::app()->session['redirectUrl']);		if(Yii::app()->user->isGuest) $this->redirect ('/main/login');		$this->user = Users::model()->findByPk(Yii::app()->user->id);		$this->is_access_search = isset($this->user->profiles->id) && isset($this->user->organizations->id);		$this->messagesCount = Messages::model()->count('receiving_user_id = ' . $this->user->id . ' AND is_deleted = 0 AND is_view = 0');		$this->notesCount = Notes::model()->count('user_id = ' . $this->user->id . ' AND is_show = 0 AND start >= CURDATE() AND start <= DATE_ADD(CURDATE(), INTERVAL 1 DAY)');		if (!$this->user->profiles && !$this->user->organizations)			Yii::app()->user->setFlash('_default', 'Для полноценной работы с сайтом обязательно введите Ваши <a href=\'/user\' style=\'color:#5895C0\'>личные данные</a> и данные о Вашей <a href=\'/user/organization\' style=\'color:#5895C0\'>организации</a>.');		elseif (!$this->user->profiles)			Yii::app()->user->setFlash('_default', 'Для полноценной работы с сайтом обязательно введите Ваши <a href=\'/user\' style=\'color:#5895C0\'>личные данные</a>.');		elseif (!$this->user->organizations)			Yii::app()->user->setFlash('_default', 'Для полноценной работы с сайтом обязательно введите данные о Вашей <a href=\'/user/organization\' style=\'color:#5895C0\'>организации</a>.');		if ($this->user->profiles)		{			if ($this->user->profiles->userType == UserTypes::FREIGHTER)				$this->headerUrl = '/goods/search';			if ($this->user->profiles->userType == UserTypes::SHIPPER)				$this->headerUrl = '/vehicle/search';			if ($this->user->profiles->userType == UserTypes::DISPATCHER)			{				if (count($this->user->vehicles) >= count($user->goods))					$this->headerUrl = '/goods/search';				else					$this->headerUrl = '/vehicle/search';			}		}	}}